<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Карта самокатов</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=b3c41ed5-5049-4941-8a78-0520971dc741"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body, #map {
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }
    #status {
      position: absolute;
      top: 12px;
      left: 12px;
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      z-index: 100;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="status">Загрузка...</div>
  <script>
    const API_URL = 'https://bag-amsterdam-hebrew-enforcement.trycloudflare.com/api/devices';
    const SCOOTER_ICON = 'data:image/png;base64,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ZUiflyF9Xgb3eRnc52VQn5dBfV4G9nnZ3+dlf5+X/X1e9vd52d/nZV+fl719Xvb2ednT52VPn5fdfV5293nZ1edlV5+XnX1edvZ52dHnZXufl+19Xrb1ednW52Vrn5etfV629HnZ0udlc5+XzX1eNvV52dTnZWOfl419Xjb0ednQ52V9n5f1fV7W9XlZ1+dlbZ+XtX1e1vZ5WdPnZU2flzV9Xlb3eVnd52VVn5dVfV5W9nlZ2edlRZ+XFX1elvd5Wd7nZVmflyV9Xpb2eVnS52VJn5fFfV4W93lZ1OdlUZ+XRX1eFvZ5WdjnZUGfl/l9Xub3eZnX52Ven5e5fV7m9nmZ0+dlTp+X2X1eZvd5mdXnZWaflxl9Xmb0eZne52V6n5dpfV6m9XmZ2udlap+XKX1epvR5mdznZXKfl0l9Xib1eZnY52Vin5cJfV4m9HkZ3+dlfJ+XcX1exvZ5GdvnZUyfl9F9Xkb3eRnV52VUn5eRfV5G9HkZ0edleJ+X4X1ehvV5GdbnZWifl6F9Xob0eRnS52VIn5fBfV4G93kZ1OdlUJ+XgX1e9vd52d/nZX+fl/19Xvb3ednX52Vvn5e9fV729HnZ0+dlT5+X3X1edvd52dXnZVefl519Xnb2ednR52V7n5ftfV629XnZ1udla5+XrX1etvR52dLnZXOfl819Xjb1ednU52Vjn5eNfV429HnZ0OdlfZ+X9X1e1vV5WdfnZW2fl7V9Xtb2eVnT52VNn5c1fV5W93lZ3edlVZ+XVX1eVvV5WdnnZWWflxV9Xlb0eVne52V5n5dlfV6W9nlZ2udlSZ+XxX1eFvd5WdTnZVGfl0V9Xhb2eVnY52VBn5f5fV7m93mZ1+dlXp+XuX1e5vZ5mdPnZU6fl9l9Xmb3eZnV52Vmn5cZfV5m9HmZ3udlep+XaX1epvV5mdrnZWqfl6l9Xqb0eZnS52Vyn5fJfV4m9XmZ1OdlYp+XiX1eJvR5mdDnZXyfl/F9Xsb1eRnb52Vsn5cxfV5G93kZ3edlVJ+XUX1eRvZ5GdHnZXifl+F9Xob1eRnW52Von5chfV6G9HkZ0udlcJ+XwX1eBvV5GdTnZWCfl/19Xvb3ednf52X/f673f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n3f5n...... (сокращено для краткости)';

    let map;
    const placemarks = new Map();
    ymaps.ready(() => {
      map = new ymaps.Map('map', {
        center: [55.75, 37.62],
        zoom: 11,
        controls: ['zoomControl', 'typeSelector']
      });
      updateMap();
      setInterval(updateMap, 15000);
    });

    async function updateMap() {
      const status = document.getElementById('status');
      try {
        status.textContent = '📡 Запрос данных...';
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const devices = await res.json();
        const validDevices = devices.filter(d =>
          d.imei && d.latitude && d.longitude &&
          !isNaN(parseFloat(d.latitude)) && !isNaN(parseFloat(d.longitude))
        );
        validDevices.forEach(d => {
          const coords = [parseFloat(d.latitude), parseFloat(d.longitude)];
          const time = d.dateConnection 
            ? new Date(d.dateConnection).toLocaleTimeString('ru-RU')
            : '—';
          const voltage = d.voltage_pit != null 
            ? `${parseFloat(d.voltage_pit).toFixed(1)} В` 
            : '—';
          const detailUrl = `https://rentdrive.ru/scooter/${d.imei}`;
          const balloon = `
            <b>${d.name || 'Самокат'}</b><br>
            IMEI: ${d.imei}<br>
            Напряжение: ${voltage}<br>
            Время: ${time}<br>
            <a href="${detailUrl}" target="_blank" style="color:#007bff; text-decoration:underline; font-size:13px;">
              Подробнее →
            </a>
          `;
          if (placemarks.has(d.imei)) {
            const pm = placemarks.get(d.imei);
            pm.geometry.setCoordinates(coords);
            pm.properties.set({ balloonContent: balloon });
          } else {
            const pm = new ymaps.Placemark(coords, { balloonContent: balloon }, {
              iconLayout: 'default#image',
              iconImageHref: SCOOTER_ICON,
              iconImageSize: [32, 32],
              iconImageOffset: [-16, -32],
              cursor: 'pointer'
            });
            map.geoObjects.add(pm);
            placemarks.set(d.imei, pm);
          }
        });
        const currentImeis = new Set(validDevices.map(d => d.imei));
        for (const [imei, pm] of placemarks.entries()) {
          if (!currentImeis.has(imei)) {
            map.geoObjects.remove(pm);
            placemarks.delete(imei);
          }
        }
        status.textContent = `✅ Самокатов: ${validDevices.length}`;
      } catch (err) {
        console.error('Ошибка:', err);
        status.textContent = `❌ Ошибка: ${err.message || 'сеть/API'}`;
      }
    }
  </script>
</body>
</html>
